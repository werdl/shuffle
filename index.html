<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="
https://cdn.jsdelivr.net/npm/jetbrains-mono@1.0.6/css/jetbrains-mono.min.css
" rel="stylesheet">
    <title>Document</title>

    <style>
        #array{
            height: 95vh;
            display: flex;
            justify-content: flex-end;
            align-items: flex-end; /* Updated property */

            margin-bottom: 0;
        }

        #array div{
            padding-bottom: 1.5vw;
            /* make text centered, white, and Jetbrains Mono font */
            text-align: center;
            color: white;
            padding: 0 0.5vw;
            font-family: 'Jetbrains Mono', monospace;

            font-size: 1.5vw;

            background-color: red;

            margin-bottom: 1vh;
        }
    </style>
</head>
<body>
    <div id="array">

    </div>
    <script>
        function fill(div, arr){
            // fill the div with columns, given that arr[n] will be less than 100, make the column height arr[n]% of the div height

            // first, clear the div
            document.getElementById('array').innerHTML = '';

            // calculated column width in px (without suffix)
            let columnWidth = (100 / arr.length) - 0.5;


            // if columnWidth is too small, scale the margin to make it the same size, then halve the column width
            if(columnWidth < 0.5){
                document.getElementById('array').style.margin = `0 0`;
                columnWidth *= 2;
            } else {
                document.getElementById('array').style.margin = '0 0.5vw';
            }

            for(let i = 0; i < arr.length; i++){
                let column = document.createElement('div');
                column.style.width = columnWidth + 'vw';
                column.style.height = (90 * arr[i]/100) + 'vh';
                column.style.display = 'inline-block';

                if (arr.length <= 35) {
                    column.innerText = arr[i];
                }

                document.getElementById(div).appendChild(column);
            }


        }

        async function bubbleSort(arr, timeToWait = 100){
            // bubble sort the array - filling the array after each swap
            let n = arr.length;
            let swapped = false;

            fill('array', arr);

            do{
                // make the current column green

                swapped = false;
                for(let i = 0; i < n - 1; i++){
                    if(arr[i] > arr[i + 1]){
                        let temp = arr[i];
                        arr[i] = arr[i + 1];
                        arr[i + 1] = temp;

                        fill('array', arr);
                        let current_column = document.getElementById('array').children[i + 1];

                        current_column.style.backgroundColor = 'green';
                        await new Promise(r => setTimeout(r, timeToWait));

                        swapped = true;
                    }
                }

            } while(swapped);

            // make all columns green (and make them jump)
            for(let i = 0; i < n; i++){
                let current_column = document.getElementById('array').children[i];
                current_column.style.backgroundColor = 'green';
                current_column.style.transform = 'translateY(-5vh)';
            }

            setTimeout(() => {
                // make all columns red again
                for(let i = 0; i < n; i++){
                    let current_column = document.getElementById('array').children[i];
                    current_column.style.backgroundColor = 'red';
                    current_column.style.transform = 'translateY(0)';
                }
            }, 300);
        }

        function startSorting(){
            // get the speed, algorithm, and array size
            let speed = document.getElementById('speed').value;
            let algorithm = document.getElementById('algorithm').value;
            let size = document.getElementById('size').value;

            // generate an array
            let arr = [];

            // now puff it up to 20 elements
            while(arr.length < size){
                arr.push(Math.floor(Math.random() * 100));
            }

            // now delete the dialog box
            document.body.removeChild(document.querySelector('#dialog'));

            // start sorting
            switch(algorithm){
                case 'bubble':
                    bubbleSort(arr, speed);
                    break;
                case 'quick':
                    quickSort(arr, speed);
                    break;
                case 'merge':
                    mergeSort(arr, speed);
                    break;
                case 'heap':
                    heapSort(arr, speed);
                    break;
            }
        }

        window.onload = () => {
            // now, create a dialog box to ask the user for speed, algorithm, and array size
            // superimpose the dialog box on the screen
            let dialog = document.createElement('div');
            dialog.style.position = 'absolute';
            dialog.style.top = '50%';
            dialog.style.left = '50%';
            dialog.style.transform = 'translate(-50%, -50%)';
            dialog.style.backgroundColor = 'white';
            dialog.style.padding = '2vw';
            dialog.style.borderRadius = '1vw';
            dialog.style.boxShadow = '0 0 1vw rgba(0, 0, 0, 0.5)';
            dialog.style.zIndex = '1000';
            dialog.id = 'dialog';

            dialog.innerHTML = `
                <h1>Sorting Visualizer</h1>
                <label for="speed" id="speedlabel">Speed: 100ms</label>
                <input type="range" id="speed" min="1" max="300" step=1 value="100">
                <br>
                <label for="algorithm">Algorithm:</label>
                <select id="algorithm">
                    <option value="bubble">Bubble Sort</option>
                    <option value="quick">Quick Sort</option>
                    <option value="merge">Merge Sort</option>
                    <option value="heap">Heap Sort</option>
                </select>
                <br>
                <label for="size">Array Size:</label>
                <input type="number" id="size" min="5" max="100" value="20">
                <br>
                <button onclick="startSorting()">Start</button>
            `;



            document.body.appendChild(dialog);
                        // now add an event listener to the dialog box to display the current speed value in the speed label
                        document.getElementById('speed').addEventListener('input', () => {
                document.getElementById('speedlabel').innerText = 'Speed: ' + document.getElementById('speed').value.toString().padStart(3, '0') + 'ms';
            });
        }
    </script>
</body>
</html>